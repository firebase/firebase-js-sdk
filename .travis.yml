language: node_js
node_js:
  - 6
cache: yarn

# Define global C++ compiler version
env:
  global:
    - CXX=g++-4.8
    - PROJECT_CONFIG='{"apiKey":"AIzaSyB3F1s2VDupQXEMopVv9nvvNskBz5BfyME","authDomain":"web-push-by-fcm.firebaseapp.com","databaseURL":"https://web-push-by-fcm.firebaseio.com","projectId":"web-push-by-fcm","storageBucket":"web-push-by-fcm.appspot.com","messagingSenderId":"1084640982992"}'
    - FIREBASE_TOKEN=dabZThsO5_0:APA91bEOAmgqKh9ixy6rWPBx_NpUxBe0dl_I3ZDlBvyYjBrSqCX409gmGvY-uu3Y1cb2O2d3IF9SaZFLQnzNaW6BGW0AhndZDOqiGTMpQBlfbHCO15yGDbYdUg0hQoBn_pmkGctEKfSo
  matrix:
    - TEST_ENV=node
    - TEST_ENV=browser
before_install:
  # Yarn defaults to an old version, make sure we
  # get an up to date version
  - npm install -g yarn
before_script:
  - export PATH=$PATH:./node_modules/.bin
  - mkdir -p tests/config && echo "$PROJECT_CONFIG" > tests/config/project.json
script:
  gulp test --env="$TEST_ENV"

# Integration Test suite
jobs:
  include:
    - stage: Integration Tests
      script: ./integration/webpack/runner.sh
    - script: ./integration/browserify/runner.sh
    - script: ./integration/typescript/runner.sh
    - script: ./integration/serviceWorker/runner.sh
    - script: ./integration/quickstart/runner.sh

# Misc Addons/Configs
dist: trusty
sudo: required
addons:
  apt:
    sources:
      - google-chrome
      - ubuntu-toolchain-r-test
    packages:
      - google-chrome-stable
      - g++-4.8
