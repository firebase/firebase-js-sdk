Project: /docs/reference/js/_project.yaml
Book: /docs/reference/_book.yaml
page_type: reference

{% comment %}
DO NOT EDIT THIS FILE!
This is generated by the JS SDK team, and any local changes will be
overwritten. Changes should be made in the source code at
https://github.com/firebase/firebase-js-sdk
{% endcomment %}

# Pipeline class
> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

The Pipeline class provides a flexible and expressive framework for building complex data transformation and query pipelines for Firestore.

A pipeline takes data sources, such as Firestore collections or collection groups, and applies a series of stages that are chained together. Each stage takes the output from the previous stage (or the data source) and produces an output for the next stage (or as the final output of the pipeline).

Expressions can be used within each stage to filter and transform data through the stage.

NOTE: The chained stages do not prescribe exactly how Firestore will execute the pipeline. Instead, Firestore only guarantees that the result is the same as if the chained stages were executed in order.

Usage Examples:

<b>Signature:</b>

```typescript
export declare class Pipeline 
```

## Methods

|  Method | Modifiers | Description |
|  --- | --- | --- |
|  [addFields(field, additionalFields)](./firestore_lite_pipelines.pipeline.md#pipelineaddfields) |  | <b><i>(Public Preview)</i></b> Adds new fields to outputs from previous stages.<!-- -->This stage allows you to compute values on-the-fly based on existing data from previous stages or constants. You can use this to create new fields or overwrite existing ones (if there is name overlaps).<!-- -->The added fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface)<!-- -->s, which can be:<!-- -->- [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [Expression](./firestore_pipelines.expression.md#expression_class)<!-- -->: Either a literal value (see [constant()](./firestore_pipelines.md#constant_0c00f91)<!-- -->) or a computed value with an assigned alias using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.<!-- -->Example: |
|  [addFields(options)](./firestore_lite_pipelines.pipeline.md#pipelineaddfields) |  | <b><i>(Public Preview)</i></b> Adds new fields to outputs from previous stages.<!-- -->This stage allows you to compute values on-the-fly based on existing data from previous stages or constants. You can use this to create new fields or overwrite existing ones (if there is name overlaps).<!-- -->The added fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface)<!-- -->s, which can be:<!-- -->- [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [Expression](./firestore_pipelines.expression.md#expression_class)<!-- -->: Either a literal value (see [constant()](./firestore_pipelines.md#constant_0c00f91)<!-- -->) or a computed value with an assigned alias using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.<!-- -->Example: |
|  [aggregate(accumulator, additionalAccumulators)](./firestore_lite_pipelines.pipeline.md#pipelineaggregate) |  | <b><i>(Public Preview)</i></b> Performs aggregation operations on the documents from previous stages.<p>This stage allows you to calculate aggregate values over a set of documents. You define the aggregations to perform using [AliasedAggregate](./firestore_pipelines.aliasedaggregate.md#aliasedaggregate_class) expressions which are typically results of calling [Expression.as()](./firestore_pipelines.expression.md#expressionas) on [AggregateFunction](./firestore_pipelines.aggregatefunction.md#aggregatefunction_class) instances.<p>Example: |
|  [aggregate(options)](./firestore_lite_pipelines.pipeline.md#pipelineaggregate) |  | <b><i>(Public Preview)</i></b> Performs optionally grouped aggregation operations on the documents from previous stages.<p>This stage allows you to calculate aggregate values over a set of documents, optionally grouped by one or more fields or functions. You can specify:<ul> <li>\*\*Grouping Fields or Functions:\*\* One or more fields or functions to group the documents by. For each distinct combination of values in these fields, a separate group is created. If no grouping fields are provided, a single group containing all documents is used. Not specifying groups is the same as putting the entire inputs into one group.</li> <li>\*\*Accumulators:\*\* One or more accumulation operations to perform within each group. These are defined using [AliasedAggregate](./firestore_pipelines.aliasedaggregate.md#aliasedaggregate_class) expressions, which are typically created by calling [Expression.as()](./firestore_pipelines.expression.md#expressionas) on [AggregateFunction](./firestore_pipelines.aggregatefunction.md#aggregatefunction_class) instances. Each aggregation calculates a value (e.g., sum, average, count) based on the documents within its group.</li> </ul><p>Example: |
|  [distinct(group, additionalGroups)](./firestore_lite_pipelines.pipeline.md#pipelinedistinct) |  | <b><i>(Public Preview)</i></b> Returns a set of distinct values from the inputs to this stage.<!-- -->This stage runs through the results from previous stages to include only results with unique combinations of [Expression](./firestore_pipelines.expression.md#expression_class) values ([Field](./firestore_pipelines.field.md#field_class)<!-- -->, [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->, etc).<!-- -->The parameters to this stage are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions or strings:<!-- -->- <code>string</code>: Name of an existing field - [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.<!-- -->Example: |
|  [distinct(options)](./firestore_lite_pipelines.pipeline.md#pipelinedistinct) |  | <b><i>(Public Preview)</i></b> Returns a set of distinct values from the inputs to this stage.<!-- -->This stage runs through the results from previous stages to include only results with unique combinations of [Expression](./firestore_pipelines.expression.md#expression_class) values ([Field](./firestore_pipelines.field.md#field_class)<!-- -->, [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->, etc).<!-- -->The parameters to this stage are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions or strings:<!-- -->- <code>string</code>: Name of an existing field - [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.<!-- -->Example: |
|  [findNearest(options)](./firestore_lite_pipelines.pipeline.md#pipelinefindnearest) |  | <b><i>(Public Preview)</i></b> Performs a vector proximity search on the documents from the previous stage, returning the K-nearest documents based on the specified query <code>vectorValue</code> and <code>distanceMeasure</code>. The returned documents will be sorted in order from nearest to furthest from the query <code>vectorValue</code>.<p>Example:
```typescript
// Find the 10 most similar books based on the book description.
const bookDescription = "Lorem ipsum...";
const queryVector: number[] = ...; // compute embedding of `bookDescription`

firestore.pipeline().collection("books")
    .findNearest({
      field: 'embedding',
      vectorValue: queryVector,
      distanceMeasure: 'euclidean',
      limit: 10,                        // optional
      distanceField: 'computedDistance' // optional
    });

```
 |
|  [limit(limit)](./firestore_lite_pipelines.pipeline.md#pipelinelimit) |  | <b><i>(Public Preview)</i></b> Limits the maximum number of documents returned by previous stages to <code>limit</code>.<p>This stage is particularly useful when you want to retrieve a controlled subset of data from a potentially large result set. It's often used for:<ul> <li>\*\*Pagination:\*\* In combination with  to retrieve specific pages of results.</li> <li>\*\*Limiting Data Retrieval:\*\* To prevent excessive data transfer and improve performance, especially when dealing with large collections.</li> </ul><p>Example: |
|  [limit(options)](./firestore_lite_pipelines.pipeline.md#pipelinelimit) |  | <b><i>(Public Preview)</i></b> Limits the maximum number of documents returned by previous stages to <code>limit</code>.<p>This stage is particularly useful when you want to retrieve a controlled subset of data from a potentially large result set. It's often used for:<ul> <li>\*\*Pagination:\*\* In combination with  to retrieve specific pages of results.</li> <li>\*\*Limiting Data Retrieval:\*\* To prevent excessive data transfer and improve performance, especially when dealing with large collections.</li> </ul><p>Example: |
|  [offset(offset)](./firestore_lite_pipelines.pipeline.md#pipelineoffset) |  | <b><i>(Public Preview)</i></b> Skips the first <code>offset</code> number of documents from the results of previous stages.<p>This stage is useful for implementing pagination in your pipelines, allowing you to retrieve results in chunks. It is typically used in conjunction with  to control the size of each page.<p>Example: |
|  [offset(options)](./firestore_lite_pipelines.pipeline.md#pipelineoffset) |  | <b><i>(Public Preview)</i></b> Skips the first <code>offset</code> number of documents from the results of previous stages.<p>This stage is useful for implementing pagination in your pipelines, allowing you to retrieve results in chunks. It is typically used in conjunction with  to control the size of each page.<p>Example: |
|  [rawStage(name, params, options)](./firestore_lite_pipelines.pipeline.md#pipelinerawstage) |  | <b><i>(Public Preview)</i></b> Adds a raw stage to the pipeline.<p>This method provides a flexible way to extend the pipeline's functionality by adding custom stages. Each raw stage is defined by a unique <code>name</code> and a set of <code>params</code> that control its behavior.<p>Example (Assuming there is no 'where' stage available in SDK): |
|  [removeFields(fieldValue, additionalFields)](./firestore_lite_pipelines.pipeline.md#pipelineremovefields) |  | <b><i>(Public Preview)</i></b> Remove fields from outputs of previous stages.<!-- -->Example: |
|  [removeFields(options)](./firestore_lite_pipelines.pipeline.md#pipelineremovefields) |  | <b><i>(Public Preview)</i></b> Remove fields from outputs of previous stages.<!-- -->Example: |
|  [replaceWith(fieldName)](./firestore_lite_pipelines.pipeline.md#pipelinereplacewith) |  | <b><i>(Public Preview)</i></b> Fully overwrites all fields in a document with those coming from a nested map.<p>This stage allows you to emit a map value as a document. Each key of the map becomes a field on the document that contains the corresponding value.<p>Example: |
|  [replaceWith(expr)](./firestore_lite_pipelines.pipeline.md#pipelinereplacewith) |  | <b><i>(Public Preview)</i></b> Fully overwrites all fields in a document with those coming from a map.<p>This stage allows you to emit a map value as a document. Each key of the map becomes a field on the document that contains the corresponding value.<p>Example: |
|  [replaceWith(options)](./firestore_lite_pipelines.pipeline.md#pipelinereplacewith) |  | <b><i>(Public Preview)</i></b> Fully overwrites all fields in a document with those coming from a map.<p>This stage allows you to emit a map value as a document. Each key of the map becomes a field on the document that contains the corresponding value.<p>Example: |
|  [sample(documents)](./firestore_lite_pipelines.pipeline.md#pipelinesample) |  | <b><i>(Public Preview)</i></b> Performs a pseudo-random sampling of the documents from the previous stage.<p>This stage will filter documents pseudo-randomly. The parameter specifies how number of documents to be returned.<p>Examples: |
|  [sample(options)](./firestore_lite_pipelines.pipeline.md#pipelinesample) |  | <b><i>(Public Preview)</i></b> Performs a pseudo-random sampling of the documents from the previous stage.<p>This stage will filter documents pseudo-randomly. The 'options' parameter specifies how sampling will be performed. See [SampleStageOptions](./firestore_pipelines.md#samplestageoptions) for more information. |
|  [select(selection, additionalSelections)](./firestore_lite_pipelines.pipeline.md#pipelineselect) |  | <b><i>(Public Preview)</i></b> Selects or creates a set of fields from the outputs of previous stages.<p>The selected fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions, which can be:<ul> <li><code>string</code> : Name of an existing field</li> <li>[Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing field.</li> <li>[AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)</li> </ul><p>If no selections are provided, the output of this stage is empty. Use [Pipeline.addFields()](./firestore_pipelines.pipeline.md#pipelineaddfields) instead if only additions are desired.<p>Example: |
|  [select(options)](./firestore_lite_pipelines.pipeline.md#pipelineselect) |  | <b><i>(Public Preview)</i></b> Selects or creates a set of fields from the outputs of previous stages.<p>The selected fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions, which can be:<ul> <li><code>string</code>: Name of an existing field</li> <li>[Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing field.</li> <li>[AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)</li> </ul><p>If no selections are provided, the output of this stage is empty. Use [Pipeline.addFields()](./firestore_pipelines.pipeline.md#pipelineaddfields) instead if only additions are desired.<p>Example: |
|  [sort(ordering, additionalOrderings)](./firestore_lite_pipelines.pipeline.md#pipelinesort) |  | <b><i>(Public Preview)</i></b> Sorts the documents from previous stages based on one or more [Ordering](./firestore_pipelines.ordering.md#ordering_class) criteria.<p>This stage allows you to order the results of your pipeline. You can specify multiple [Ordering](./firestore_pipelines.ordering.md#ordering_class) instances to sort by multiple fields in ascending or descending order. If documents have the same value for a field used for sorting, the next specified ordering will be used. If all orderings result in equal comparison, the documents are considered equal and the order is unspecified.<p>Example: |
|  [sort(options)](./firestore_lite_pipelines.pipeline.md#pipelinesort) |  | <b><i>(Public Preview)</i></b> Sorts the documents from previous stages based on one or more [Ordering](./firestore_pipelines.ordering.md#ordering_class) criteria.<p>This stage allows you to order the results of your pipeline. You can specify multiple [Ordering](./firestore_pipelines.ordering.md#ordering_class) instances to sort by multiple fields in ascending or descending order. If documents have the same value for a field used for sorting, the next specified ordering will be used. If all orderings result in equal comparison, the documents are considered equal and the order is unspecified.<p>Example: |
|  [union(other)](./firestore_lite_pipelines.pipeline.md#pipelineunion) |  | <b><i>(Public Preview)</i></b> Performs union of all documents from two pipelines, including duplicates.<p>This stage will pass through documents from previous stage, and also pass through documents from previous stage of the <code>other</code> [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) given in parameter. The order of documents emitted from this stage is undefined.<p>Example: |
|  [union(options)](./firestore_lite_pipelines.pipeline.md#pipelineunion) |  | <b><i>(Public Preview)</i></b> Performs union of all documents from two pipelines, including duplicates.<p>This stage will pass through documents from previous stage, and also pass through documents from previous stage of the <code>other</code> [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) given in parameter. The order of documents emitted from this stage is undefined.<p>Example: |
|  [unnest(selectable, indexField)](./firestore_lite_pipelines.pipeline.md#pipelineunnest) |  | <b><i>(Public Preview)</i></b> Produces a document for each element in an input array.<!-- -->For each previous stage document, this stage will emit zero or more augmented documents. The input array specified by the <code>selectable</code> parameter, will emit an augmented document for each input array element. The input array element will augment the previous stage document by setting the <code>alias</code> field with the array element value.<!-- -->When <code>selectable</code> evaluates to a non-array value (ex: number, null, absent), then the stage becomes a no-op for the current input document, returning it as is with the <code>alias</code> field absent.<!-- -->No documents are emitted when <code>selectable</code> evaluates to an empty array.<!-- -->Example: |
|  [unnest(options)](./firestore_lite_pipelines.pipeline.md#pipelineunnest) |  | <b><i>(Public Preview)</i></b> Produces a document for each element in an input array.<!-- -->For each previous stage document, this stage will emit zero or more augmented documents. The input array specified by the <code>selectable</code> parameter, will emit an augmented document for each input array element. The input array element will augment the previous stage document by setting the <code>alias</code> field with the array element value.<!-- -->When <code>selectable</code> evaluates to a non-array value (ex: number, null, absent), then the stage becomes a no-op for the current input document, returning it as is with the <code>alias</code> field absent.<!-- -->No documents are emitted when <code>selectable</code> evaluates to an empty array.<!-- -->Example: |
|  [where(condition)](./firestore_lite_pipelines.pipeline.md#pipelinewhere) |  | <b><i>(Public Preview)</i></b> Filters the documents from previous stages to only include those matching the specified [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->.<p>This stage allows you to apply conditions to the data, similar to a "WHERE" clause in SQL. You can filter documents based on their field values, using implementations of [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->, typically including but not limited to:<ul> <li>field comparators: [Expression.equal()](./firestore_pipelines.expression.md#expressionequal)<!-- -->, [Expression.lessThan()](./firestore_pipelines.expression.md#expressionlessthan)<!-- -->, [Expression.greaterThan()](./firestore_pipelines.expression.md#expressiongreaterthan)<!-- -->, etc.</li> <li>logical operators: , , , etc.</li> <li>advanced functions: [Expression.regexMatch()](./firestore_pipelines.expression.md#expressionregexmatch)<!-- -->, [Expression.arrayContains()](./firestore_pipelines.expression.md#expressionarraycontains)<!-- -->, etc.</li> </ul><p>Example: |
|  [where(options)](./firestore_lite_pipelines.pipeline.md#pipelinewhere) |  | <b><i>(Public Preview)</i></b> Filters the documents from previous stages to only include those matching the specified [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->.<p>This stage allows you to apply conditions to the data, similar to a "WHERE" clause in SQL. You can filter documents based on their field values, using implementations of [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->, typically including but not limited to:<ul> <li>field comparators: ,  (less than), [Expression.greaterThan()](./firestore_pipelines.expression.md#expressiongreaterthan)<!-- -->, etc.</li> <li>logical operators: , , , etc.</li> <li>advanced functions: [Expression.regexMatch()](./firestore_pipelines.expression.md#expressionregexmatch)<!-- -->, [Expression.arrayContains()](./firestore_pipelines.expression.md#expressionarraycontains)<!-- -->, etc.</li> </ul><p>Example: |

## Pipeline.addFields()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Adds new fields to outputs from previous stages.

This stage allows you to compute values on-the-fly based on existing data from previous stages or constants. You can use this to create new fields or overwrite existing ones (if there is name overlaps).

The added fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface)<!-- -->s, which can be:

- [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [Expression](./firestore_pipelines.expression.md#expression_class)<!-- -->: Either a literal value (see [constant()](./firestore_pipelines.md#constant_0c00f91)<!-- -->) or a computed value with an assigned alias using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.

Example:

<b>Signature:</b>

```typescript
addFields(field: Selectable, ...additionalFields: Selectable[]): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  field | [Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface) | The first field to add to the documents, specified as a [Selectable](./firestore_pipelines.selectable.md#selectable_interface)<!-- -->. |
|  additionalFields | [Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface)<!-- -->\[\] | Optional additional fields to add to the documents, specified as [Selectable](./firestore_pipelines.selectable.md#selectable_interface)<!-- -->s. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
firestore.pipeline().collection("books")
  .addFields(
    field("rating").as("bookRating"), // Rename 'rating' to 'bookRating'
    add(5, field("quantity")).as("totalCost")  // Calculate 'totalCost'
  );

```

## Pipeline.addFields()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Adds new fields to outputs from previous stages.

This stage allows you to compute values on-the-fly based on existing data from previous stages or constants. You can use this to create new fields or overwrite existing ones (if there is name overlaps).

The added fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface)<!-- -->s, which can be:

- [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [Expression](./firestore_pipelines.expression.md#expression_class)<!-- -->: Either a literal value (see [constant()](./firestore_pipelines.md#constant_0c00f91)<!-- -->) or a computed value with an assigned alias using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.

Example:

<b>Signature:</b>

```typescript
addFields(options: AddFieldsStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [AddFieldsStageOptions](./firestore_lite_pipelines.md#addfieldsstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
firestore.pipeline().collection("books")
  .addFields(
    field("rating").as("bookRating"), // Rename 'rating' to 'bookRating'
    add(5, field("quantity")).as("totalCost")  // Calculate 'totalCost'
  );

```

## Pipeline.aggregate()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs aggregation operations on the documents from previous stages.

<p>This stage allows you to calculate aggregate values over a set of documents. You define the aggregations to perform using [AliasedAggregate](./firestore_pipelines.aliasedaggregate.md#aliasedaggregate_class) expressions which are typically results of calling [Expression.as()](./firestore_pipelines.expression.md#expressionas) on [AggregateFunction](./firestore_pipelines.aggregatefunction.md#aggregatefunction_class) instances.

<p>Example:

<b>Signature:</b>

```typescript
aggregate(accumulator: AliasedAggregate, ...additionalAccumulators: AliasedAggregate[]): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  accumulator | [AliasedAggregate](./firestore_lite_pipelines.aliasedaggregate.md#aliasedaggregate_class) | The first [AliasedAggregate](./firestore_pipelines.aliasedaggregate.md#aliasedaggregate_class)<!-- -->, wrapping an [AggregateFunction](./firestore_pipelines.aggregatefunction.md#aggregatefunction_class) and providing a name for the accumulated results. |
|  additionalAccumulators | [AliasedAggregate](./firestore_lite_pipelines.aliasedaggregate.md#aliasedaggregate_class)<!-- -->\[\] | Optional additional [AliasedAggregate](./firestore_pipelines.aliasedaggregate.md#aliasedaggregate_class)<!-- -->, each wrapping an [AggregateFunction](./firestore_pipelines.aggregatefunction.md#aggregatefunction_class) and providing a name for the accumulated results. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
// Calculate the average rating and the total number of books
firestore.pipeline().collection("books")
    .aggregate(
        field("rating").avg().as("averageRating"),
        countAll().as("totalBooks")
    );

```

## Pipeline.aggregate()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs optionally grouped aggregation operations on the documents from previous stages.

<p>This stage allows you to calculate aggregate values over a set of documents, optionally grouped by one or more fields or functions. You can specify:

<ul> <li>\*\*Grouping Fields or Functions:\*\* One or more fields or functions to group the documents by. For each distinct combination of values in these fields, a separate group is created. If no grouping fields are provided, a single group containing all documents is used. Not specifying groups is the same as putting the entire inputs into one group.</li> <li>\*\*Accumulators:\*\* One or more accumulation operations to perform within each group. These are defined using [AliasedAggregate](./firestore_pipelines.aliasedaggregate.md#aliasedaggregate_class) expressions, which are typically created by calling [Expression.as()](./firestore_pipelines.expression.md#expressionas) on [AggregateFunction](./firestore_pipelines.aggregatefunction.md#aggregatefunction_class) instances. Each aggregation calculates a value (e.g., sum, average, count) based on the documents within its group.</li> </ul>

<p>Example:

<b>Signature:</b>

```typescript
aggregate(options: AggregateStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [AggregateStageOptions](./firestore_lite_pipelines.md#aggregatestageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Calculate the average rating for each genre.
firestore.pipeline().collection("books")
  .aggregate({
      accumulators: [avg(field("rating")).as("avg_rating")]
      groups: ["genre"]
      });

```

## Pipeline.distinct()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Returns a set of distinct values from the inputs to this stage.

This stage runs through the results from previous stages to include only results with unique combinations of [Expression](./firestore_pipelines.expression.md#expression_class) values ([Field](./firestore_pipelines.field.md#field_class)<!-- -->, [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->, etc).

The parameters to this stage are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions or strings:

- `string`<!-- -->: Name of an existing field - [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.

Example:

<b>Signature:</b>

```typescript
distinct(group: string | Selectable, ...additionalGroups: Array<string | Selectable>): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  group | string \| [Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface) | The [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expression or field name to consider when determining distinct value combinations. |
|  additionalGroups | Array&lt;string \| [Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface)<!-- -->&gt; | Optional additional [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions to consider when determining distinct value combinations or strings representing field names. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Get a list of unique author names in uppercase and genre combinations.
firestore.pipeline().collection("books")
    .distinct(toUppercase(field("author")).as("authorName"), field("genre"), "publishedAt")
    .select("authorName");

```

## Pipeline.distinct()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Returns a set of distinct values from the inputs to this stage.

This stage runs through the results from previous stages to include only results with unique combinations of [Expression](./firestore_pipelines.expression.md#expression_class) values ([Field](./firestore_pipelines.field.md#field_class)<!-- -->, [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->, etc).

The parameters to this stage are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions or strings:

- `string`<!-- -->: Name of an existing field - [Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing document field. - [AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)<!-- -->.

Example:

<b>Signature:</b>

```typescript
distinct(options: DistinctStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [DistinctStageOptions](./firestore_lite_pipelines.md#distinctstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Get a list of unique author names in uppercase and genre combinations.
firestore.pipeline().collection("books")
    .distinct(toUppercase(field("author")).as("authorName"), field("genre"), "publishedAt")
    .select("authorName");

```

## Pipeline.findNearest()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs a vector proximity search on the documents from the previous stage, returning the K-nearest documents based on the specified query `vectorValue` and `distanceMeasure`<!-- -->. The returned documents will be sorted in order from nearest to furthest from the query `vectorValue`<!-- -->.

<p>Example:

```typescript
// Find the 10 most similar books based on the book description.
const bookDescription = "Lorem ipsum...";
const queryVector: number[] = ...; // compute embedding of `bookDescription`

firestore.pipeline().collection("books")
    .findNearest({
      field: 'embedding',
      vectorValue: queryVector,
      distanceMeasure: 'euclidean',
      limit: 10,                        // optional
      distanceField: 'computedDistance' // optional
    });

```

<b>Signature:</b>

```typescript
findNearest(options: FindNearestStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [FindNearestStageOptions](./firestore_lite_pipelines.md#findneareststageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

## Pipeline.limit()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Limits the maximum number of documents returned by previous stages to `limit`<!-- -->.

<p>This stage is particularly useful when you want to retrieve a controlled subset of data from a potentially large result set. It's often used for:

<ul> <li>\*\*Pagination:\*\* In combination with  to retrieve specific pages of results.</li> <li>\*\*Limiting Data Retrieval:\*\* To prevent excessive data transfer and improve performance, especially when dealing with large collections.</li> </ul>

<p>Example:

<b>Signature:</b>

```typescript
limit(limit: number): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  limit | number | The maximum number of documents to return. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
// Limit the results to the top 10 highest-rated books
firestore.pipeline().collection('books')
    .sort(field('rating').descending())
    .limit(10);

```

## Pipeline.limit()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Limits the maximum number of documents returned by previous stages to `limit`<!-- -->.

<p>This stage is particularly useful when you want to retrieve a controlled subset of data from a potentially large result set. It's often used for:

<ul> <li>\*\*Pagination:\*\* In combination with  to retrieve specific pages of results.</li> <li>\*\*Limiting Data Retrieval:\*\* To prevent excessive data transfer and improve performance, especially when dealing with large collections.</li> </ul>

<p>Example:

<b>Signature:</b>

```typescript
limit(options: LimitStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [LimitStageOptions](./firestore_lite_pipelines.md#limitstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
// Limit the results to the top 10 highest-rated books
firestore.pipeline().collection('books')
    .sort(field('rating').descending())
    .limit(10);

```

## Pipeline.offset()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Skips the first `offset` number of documents from the results of previous stages.

<p>This stage is useful for implementing pagination in your pipelines, allowing you to retrieve results in chunks. It is typically used in conjunction with  to control the size of each page.

<p>Example:

<b>Signature:</b>

```typescript
offset(offset: number): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  offset | number | The number of documents to skip. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
// Retrieve the second page of 20 results
firestore.pipeline().collection('books')
    .sort(field('published').descending())
    .offset(20)  // Skip the first 20 results
    .limit(20);   // Take the next 20 results

```

## Pipeline.offset()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Skips the first `offset` number of documents from the results of previous stages.

<p>This stage is useful for implementing pagination in your pipelines, allowing you to retrieve results in chunks. It is typically used in conjunction with  to control the size of each page.

<p>Example:

<b>Signature:</b>

```typescript
offset(options: OffsetStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [OffsetStageOptions](./firestore_lite_pipelines.md#offsetstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
// Retrieve the second page of 20 results
firestore.pipeline().collection('books')
    .sort(field('published').descending())
    .offset(20)  // Skip the first 20 results
    .limit(20);   // Take the next 20 results

```

## Pipeline.rawStage()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Adds a raw stage to the pipeline.

<p>This method provides a flexible way to extend the pipeline's functionality by adding custom stages. Each raw stage is defined by a unique `name` and a set of `params` that control its behavior.

<p>Example (Assuming there is no 'where' stage available in SDK):

<b>Signature:</b>

```typescript
rawStage(name: string, params: unknown[], options?: {
        [key: string]: Expression | unknown;
    }): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  name | string | The unique name of the raw stage to add. |
|  params | unknown\[\] | A list of parameters to configure the raw stage's behavior. |
|  options | { \[key: string\]: [Expression](./firestore_lite_pipelines.expression.md#expression_class) \| unknown; } | An object of key value pairs that specifies optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Assume we don't have a built-in 'where' stage
firestore.pipeline().collection('books')
    .rawStage('where', [field('published').lt(1900)]) // Custom 'where' stage
    .select('title', 'author');

```

## Pipeline.removeFields()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Remove fields from outputs of previous stages.

Example:

<b>Signature:</b>

```typescript
removeFields(fieldValue: Field | string, ...additionalFields: Array<Field | string>): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  fieldValue | [Field](./firestore_lite_pipelines.field.md#field_class) \| string | The first field to remove. |
|  additionalFields | Array&lt;[Field](./firestore_lite_pipelines.field.md#field_class) \| string&gt; | Optional additional fields to remove. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
firestore.pipeline().collection('books')
  // removes field 'rating' and 'cost' from the previous stage outputs.
  .removeFields(
    field('rating'),
    'cost'
  );

```

## Pipeline.removeFields()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Remove fields from outputs of previous stages.

Example:

<b>Signature:</b>

```typescript
removeFields(options: RemoveFieldsStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [RemoveFieldsStageOptions](./firestore_lite_pipelines.md#removefieldsstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
firestore.pipeline().collection('books')
  // removes field 'rating' and 'cost' from the previous stage outputs.
  .removeFields(
    field('rating'),
    'cost'
  );

```

## Pipeline.replaceWith()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Fully overwrites all fields in a document with those coming from a nested map.

<p>This stage allows you to emit a map value as a document. Each key of the map becomes a field on the document that contains the corresponding value.

<p>Example:

<b>Signature:</b>

```typescript
replaceWith(fieldName: string): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  fieldName | string | The [Field](./firestore_pipelines.field.md#field_class) field containing the nested map. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Input.
// {
//  'name': 'John Doe Jr.',
//  'parents': {
//    'father': 'John Doe Sr.',
//    'mother': 'Jane Doe'
//   }
// }

// Emit parents as document.
firestore.pipeline().collection('people').replaceWith('parents');

// Output
// {
//  'father': 'John Doe Sr.',
//  'mother': 'Jane Doe'
// }

```

## Pipeline.replaceWith()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Fully overwrites all fields in a document with those coming from a map.

<p>This stage allows you to emit a map value as a document. Each key of the map becomes a field on the document that contains the corresponding value.

<p>Example:

<b>Signature:</b>

```typescript
replaceWith(expr: Expression): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  expr | [Expression](./firestore_lite_pipelines.expression.md#expression_class) | An [Expression](./firestore_pipelines.expression.md#expression_class) that when returned evaluates to a map. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Input.
// {
//  'name': 'John Doe Jr.',
//  'parents': {
//    'father': 'John Doe Sr.',
//    'mother': 'Jane Doe'
//   }
// }

// Emit parents as document.
firestore.pipeline().collection('people').replaceWith(map({
  foo: 'bar',
  info: {
    name: field('name')
  }
}));

// Output
// {
//  'father': 'John Doe Sr.',
//  'mother': 'Jane Doe'
// }

```

## Pipeline.replaceWith()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Fully overwrites all fields in a document with those coming from a map.

<p>This stage allows you to emit a map value as a document. Each key of the map becomes a field on the document that contains the corresponding value.

<p>Example:

<b>Signature:</b>

```typescript
replaceWith(options: ReplaceWithStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [ReplaceWithStageOptions](./firestore_lite_pipelines.md#replacewithstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Input.
// {
//  'name': 'John Doe Jr.',
//  'parents': {
//    'father': 'John Doe Sr.',
//    'mother': 'Jane Doe'
//   }
// }

// Emit parents as document.
firestore.pipeline().collection('people').replaceWith(map({
  foo: 'bar',
  info: {
    name: field('name')
  }
}));

// Output
// {
//  'father': 'John Doe Sr.',
//  'mother': 'Jane Doe'
// }

```

## Pipeline.sample()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs a pseudo-random sampling of the documents from the previous stage.

<p>This stage will filter documents pseudo-randomly. The parameter specifies how number of documents to be returned.

<p>Examples:

<b>Signature:</b>

```typescript
sample(documents: number): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  documents | number | The number of documents to sample. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Sample 25 books, if available.
firestore.pipeline().collection('books')
    .sample(25);

```

## Pipeline.sample()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs a pseudo-random sampling of the documents from the previous stage.

<p>This stage will filter documents pseudo-randomly. The 'options' parameter specifies how sampling will be performed. See [SampleStageOptions](./firestore_pipelines.md#samplestageoptions) for more information.

<b>Signature:</b>

```typescript
sample(options: SampleStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [SampleStageOptions](./firestore_lite_pipelines.md#samplestageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Sample 10 books, if available.
firestore.pipeline().collection("books")
    .sample({ documents: 10 });

// Sample 50% of books.
firestore.pipeline().collection("books")
    .sample({ percentage: 0.5 });

```

## Pipeline.select()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Selects or creates a set of fields from the outputs of previous stages.

<p>The selected fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions, which can be:

<ul> <li>`string` : Name of an existing field</li> <li>[Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing field.</li> <li>[AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)</li> </ul>

<p>If no selections are provided, the output of this stage is empty. Use [Pipeline.addFields()](./firestore_pipelines.pipeline.md#pipelineaddfields) instead if only additions are desired.

<p>Example:

<b>Signature:</b>

```typescript
select(selection: Selectable | string, ...additionalSelections: Array<Selectable | string>): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  selection | [Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface) \| string | The first field to include in the output documents, specified as [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expression or string value representing the field name. |
|  additionalSelections | Array&lt;[Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface) \| string&gt; | Optional additional fields to include in the output documents, specified as [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions or <code>string</code> values representing field names. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
db.pipeline().collection("books")
  .select(
    "firstName",
    field("lastName"),
    field("address").toUppercase().as("upperAddress"),
  );

```

## Pipeline.select()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Selects or creates a set of fields from the outputs of previous stages.

<p>The selected fields are defined using [Selectable](./firestore_pipelines.selectable.md#selectable_interface) expressions, which can be:

<ul> <li>`string`<!-- -->: Name of an existing field</li> <li>[Field](./firestore_pipelines.field.md#field_class)<!-- -->: References an existing field.</li> <li>[AliasedExpression](./firestore_pipelines.aliasedexpression.md#aliasedexpression_class)<!-- -->: Represents the result of a function with an assigned alias name using [Expression.as()](./firestore_pipelines.expression.md#expressionas)</li> </ul>

<p>If no selections are provided, the output of this stage is empty. Use [Pipeline.addFields()](./firestore_pipelines.pipeline.md#pipelineaddfields) instead if only additions are desired.

<p>Example:

<b>Signature:</b>

```typescript
select(options: SelectStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [SelectStageOptions](./firestore_lite_pipelines.md#selectstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
db.pipeline().collection("books")
  .select(
    "firstName",
    field("lastName"),
    field("address").toUppercase().as("upperAddress"),
  );

```

## Pipeline.sort()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Sorts the documents from previous stages based on one or more [Ordering](./firestore_pipelines.ordering.md#ordering_class) criteria.

<p>This stage allows you to order the results of your pipeline. You can specify multiple [Ordering](./firestore_pipelines.ordering.md#ordering_class) instances to sort by multiple fields in ascending or descending order. If documents have the same value for a field used for sorting, the next specified ordering will be used. If all orderings result in equal comparison, the documents are considered equal and the order is unspecified.

<p>Example:

<b>Signature:</b>

```typescript
sort(ordering: Ordering, ...additionalOrderings: Ordering[]): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  ordering | [Ordering](./firestore_lite_pipelines.ordering.md#ordering_class) | The first [Ordering](./firestore_pipelines.ordering.md#ordering_class) instance specifying the sorting criteria. |
|  additionalOrderings | [Ordering](./firestore_lite_pipelines.ordering.md#ordering_class)<!-- -->\[\] | Optional additional [Ordering](./firestore_pipelines.ordering.md#ordering_class) instances specifying the additional sorting criteria. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Sort books by rating in descending order, and then by title in ascending order for books
// with the same rating
firestore.pipeline().collection("books")
    .sort(
        Ordering.of(field("rating")).descending(),
        Ordering.of(field("title"))  // Ascending order is the default
    );

```

## Pipeline.sort()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Sorts the documents from previous stages based on one or more [Ordering](./firestore_pipelines.ordering.md#ordering_class) criteria.

<p>This stage allows you to order the results of your pipeline. You can specify multiple [Ordering](./firestore_pipelines.ordering.md#ordering_class) instances to sort by multiple fields in ascending or descending order. If documents have the same value for a field used for sorting, the next specified ordering will be used. If all orderings result in equal comparison, the documents are considered equal and the order is unspecified.

<p>Example:

<b>Signature:</b>

```typescript
sort(options: SortStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [SortStageOptions](./firestore_lite_pipelines.md#sortstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Sort books by rating in descending order, and then by title in ascending order for books
// with the same rating
firestore.pipeline().collection("books")
    .sort(
        Ordering.of(field("rating")).descending(),
        Ordering.of(field("title"))  // Ascending order is the default
    );

```

## Pipeline.union()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs union of all documents from two pipelines, including duplicates.

<p>This stage will pass through documents from previous stage, and also pass through documents from previous stage of the `other` [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) given in parameter. The order of documents emitted from this stage is undefined.

<p>Example:

<b>Signature:</b>

```typescript
union(other: Pipeline): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  other | [Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class) | The other [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) that is part of union. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Emit documents from books collection and magazines collection.
firestore.pipeline().collection('books')
    .union(firestore.pipeline().collection('magazines'));

```

## Pipeline.union()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Performs union of all documents from two pipelines, including duplicates.

<p>This stage will pass through documents from previous stage, and also pass through documents from previous stage of the `other` [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) given in parameter. The order of documents emitted from this stage is undefined.

<p>Example:

<b>Signature:</b>

```typescript
union(options: UnionStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [UnionStageOptions](./firestore_lite_pipelines.md#unionstageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Emit documents from books collection and magazines collection.
firestore.pipeline().collection('books')
    .union(firestore.pipeline().collection('magazines'));

```

## Pipeline.unnest()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Produces a document for each element in an input array.

For each previous stage document, this stage will emit zero or more augmented documents. The input array specified by the `selectable` parameter, will emit an augmented document for each input array element. The input array element will augment the previous stage document by setting the `alias` field with the array element value.

When `selectable` evaluates to a non-array value (ex: number, null, absent), then the stage becomes a no-op for the current input document, returning it as is with the `alias` field absent.

No documents are emitted when `selectable` evaluates to an empty array.

Example:

<b>Signature:</b>

```typescript
unnest(selectable: Selectable, indexField?: string): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  selectable | [Selectable](./firestore_lite_pipelines.selectable.md#selectable_interface) | A selectable expression defining the field to unnest and the alias to use for each un-nested element in the output documents. |
|  indexField | string | An optional string value specifying the field path to write the offset (starting at zero) into the array the un-nested element is from |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Input:
// { "title": "The Hitchhiker's Guide to the Galaxy", "tags": [ "comedy", "space", "adventure" ], ... }

// Emit a book document for each tag of the book.
firestore.pipeline().collection("books")
    .unnest(field("tags").as('tag'), 'tagIndex');

// Output:
// { "title": "The Hitchhiker's Guide to the Galaxy", "tag": "comedy", "tagIndex": 0, ... }
// { "title": "The Hitchhiker's Guide to the Galaxy", "tag": "space", "tagIndex": 1, ... }
// { "title": "The Hitchhiker's Guide to the Galaxy", "tag": "adventure", "tagIndex": 2, ... }

```

## Pipeline.unnest()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Produces a document for each element in an input array.

For each previous stage document, this stage will emit zero or more augmented documents. The input array specified by the `selectable` parameter, will emit an augmented document for each input array element. The input array element will augment the previous stage document by setting the `alias` field with the array element value.

When `selectable` evaluates to a non-array value (ex: number, null, absent), then the stage becomes a no-op for the current input document, returning it as is with the `alias` field absent.

No documents are emitted when `selectable` evaluates to an empty array.

Example:

<b>Signature:</b>

```typescript
unnest(options: UnnestStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [UnnestStageOptions](./firestore_lite_pipelines.md#unneststageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new [Pipeline](./firestore_pipelines.pipeline.md#pipeline_class) object with this stage appended to the stage list.

### Example


```typescript
// Input:
// { "title": "The Hitchhiker's Guide to the Galaxy", "tags": [ "comedy", "space", "adventure" ], ... }

// Emit a book document for each tag of the book.
firestore.pipeline().collection("books")
    .unnest(field("tags").as('tag'), 'tagIndex');

// Output:
// { "title": "The Hitchhiker's Guide to the Galaxy", "tag": "comedy", "tagIndex": 0, ... }
// { "title": "The Hitchhiker's Guide to the Galaxy", "tag": "space", "tagIndex": 1, ... }
// { "title": "The Hitchhiker's Guide to the Galaxy", "tag": "adventure", "tagIndex": 2, ... }

```

## Pipeline.where()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Filters the documents from previous stages to only include those matching the specified [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->.

<p>This stage allows you to apply conditions to the data, similar to a "WHERE" clause in SQL. You can filter documents based on their field values, using implementations of [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->, typically including but not limited to:

<ul> <li>field comparators: [Expression.equal()](./firestore_pipelines.expression.md#expressionequal)<!-- -->, [Expression.lessThan()](./firestore_pipelines.expression.md#expressionlessthan)<!-- -->, [Expression.greaterThan()](./firestore_pipelines.expression.md#expressiongreaterthan)<!-- -->, etc.</li> <li>logical operators: , , , etc.</li> <li>advanced functions: [Expression.regexMatch()](./firestore_pipelines.expression.md#expressionregexmatch)<!-- -->, [Expression.arrayContains()](./firestore_pipelines.expression.md#expressionarraycontains)<!-- -->, etc.</li> </ul>

<p>Example:

<b>Signature:</b>

```typescript
where(condition: BooleanExpression): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  condition | [BooleanExpression](./firestore_lite_pipelines.booleanexpression.md#booleanexpression_class) | The [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class) to apply. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
firestore.pipeline().collection("books")
  .where(
    and(
        gt(field("rating"), 4.0),   // Filter for ratings greater than 4.0
        field("genre").eq("Science Fiction") // Equivalent to gt("genre", "Science Fiction")
    )
  );

```

## Pipeline.where()

> This API is provided as a preview for developers and may change based on feedback that we receive. Do not use this API in a production environment.
> 

Filters the documents from previous stages to only include those matching the specified [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->.

<p>This stage allows you to apply conditions to the data, similar to a "WHERE" clause in SQL. You can filter documents based on their field values, using implementations of [BooleanExpression](./firestore_pipelines.booleanexpression.md#booleanexpression_class)<!-- -->, typically including but not limited to:

<ul> <li>field comparators: ,  (less than), [Expression.greaterThan()](./firestore_pipelines.expression.md#expressiongreaterthan)<!-- -->, etc.</li> <li>logical operators: , , , etc.</li> <li>advanced functions: [Expression.regexMatch()](./firestore_pipelines.expression.md#expressionregexmatch)<!-- -->, [Expression.arrayContains()](./firestore_pipelines.expression.md#expressionarraycontains)<!-- -->, etc.</li> </ul>

<p>Example:

<b>Signature:</b>

```typescript
where(options: WhereStageOptions): Pipeline;
```

#### Parameters

|  Parameter | Type | Description |
|  --- | --- | --- |
|  options | [WhereStageOptions](./firestore_lite_pipelines.md#wherestageoptions) | An object that specifies required and optional parameters for the stage. |

<b>Returns:</b>

[Pipeline](./firestore_lite_pipelines.pipeline.md#pipeline_class)

A new Pipeline object with this stage appended to the stage list.

### Example


```typescript
firestore.pipeline().collection("books")
  .where(
    and(
        gt(field("rating"), 4.0),   // Filter for ratings greater than 4.0
        field("genre").eq("Science Fiction") // Equivalent to gt("genre", "Science Fiction")
    )
  );

```

### Example


```typescript
const db: Firestore; // Assumes a valid firestore instance.

// Example 1: Select specific fields and rename 'rating' to 'bookRating'
const results1 = await execute(db.pipeline()
    .collection("books")
    .select("title", "author", field("rating").as("bookRating")));

// Example 2: Filter documents where 'genre' is "Science Fiction" and 'published' is after 1950
const results2 = await execute(db.pipeline()
    .collection("books")
    .where(and(field("genre").eq("Science Fiction"), field("published").gt(1950))));

// Example 3: Calculate the average rating of books published after 1980
const results3 = await execute(db.pipeline()
    .collection("books")
    .where(field("published").gt(1980))
    .aggregate(avg(field("rating")).as("averageRating")));

```

